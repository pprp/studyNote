# 多目标跟踪基础

## 1. 简介

多目标跟踪**MOT**(multi-object tracking), 同时跟踪多个目标，会出现新目标进入与旧目标消失的问题。跟踪策略通常为TBD(Tracking-by-Detection) 或者 DBT(Detection-based-Tracking)。通常是在每一帧进行目标检测，然后利用目标检测的结果进行目标跟踪，这一步称为：Data Association，数据关联。

## 2. 分类

- 在线跟踪 Online

    只使用当前帧进行数据关联

- 离线跟踪 Offline

    离线说明完整视频已经获取了，可以利用全部帧的信息

- 介于两个之间的 Near-Online

    可以利用部分未来帧的信息

## 3. 术语

- MOT: multi-object tracking
- trajectory: 轨迹，对应一个目标在一个时间段内的位置序列
- tracklet:  轨迹段，是trajectory过程中的轨迹片段
- ID switch: ID sw. 对于同一个目标，由于算法事物，导致其ID发生切换的次数，次数越小越好。

- SORT: simple online and realtime tracking

## 4. 评价指标

MOTA是最主要的评价指标，综合了FP,FN，ID sw.三个因素。

- FP: False positive 误检测的目标数量
- FN: False negative 未检测出的真实目标数量
- ID sw. ：同一个目标ID发生切换次数



## 5. SORT算法

SORT也是基于TBD的策略，所以与检测效果息息相关，目标检测的效果对跟踪影响很大。

- 在线跟踪方式，不使用未来帧，是一种一阶段匹配方法
- 基于Faster R-CNN的检测器
- 使用基于kalman filter 卡尔曼滤波 和 hungarian algorithm 匈牙利算法进行跟踪
    - 卡尔曼滤波：一种运行模型，对目标的轨迹进行预测。
    - 匈牙利算法：寻找二分图的最大匹配，用于匹配前后两帧中多个目标的匹配问题。引入IOU距离的KM算法（匈牙利算法带权重版本）
- 引入**线性速度模型**和**卡尔曼滤波**来进行**位置预测**



## 6. DeepSORT

在SORT基础上添加了 : 

- Deep Association Metric

    Deep Association Metric是在大型行人重识别网络上学习的一个行人鉴别网络，目的是区分不同的行人。

- Appearance Information: 

    实现较长时间遮挡的目标跟踪

    - 测量视频帧中各个目标之间的相似性
        - 外观模型：如何抽取有鉴别力的特征，使用行人重识别作为特征抽取器。**行人重识别算法通常提取行人图像特征，对特征进行距离度量，从而判断是否是同一个人。** 这些特征就可以用来辅助我们进行行人跟踪。若两个检测框框出的是同一个行人，那么这两个向量的距离会比较小；若不是同一个行人，这两个向量的距离会比较大。
        - 运行模型
        - 交互模型
        - 排斥模型
        - 遮挡模型
    - 基于相似性进行目标ID的恢复
        - 概率推理
        - 确定性最优化

ReID的网络。一个比较经典的方法是使用**Triplet loss**来训练一个**去掉了全连接层的ResNet**，最后一层卷积层的输出就是我们需要的特征。

Triplet loss是深度学习中的一种损失函数，用来训练差异性较小的样本，使用锚（Anchor）示例、正（Positive）示例、负（Negative）示例构成一个**三元组**，通过训练使Anchor与Positive的特征距离减小，使Anchor与Negative的距离增大，通过这种方式来学习出一个对行人有鉴别力的网络。再利用这个网络，就能**抽取出我们想要的特征**。





















